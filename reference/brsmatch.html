<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Perform balanced risk set matching as described in Li et al. (2001) &quot;Balanced
Risk Set Matching&quot;.  Given a longitudinal data frame with covariate
information, along with treatment time, build a MIP problem that matches
treated individuals to those that haven't been treated yet (or are never
treated) based on minimizing the Mahalanobis distance between covariates. If
balancing is desired, the model will try to minimize the imbalance in terms
of specified balancing covariates in the final pair output.  Each treated
individual is matched to one other individual."><title>Balanced Risk Set Matching — brsmatch • rsmatch</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Balanced Risk Set Matching — brsmatch"><meta property="og:description" content="Perform balanced risk set matching as described in Li et al. (2001) &quot;Balanced
Risk Set Matching&quot;.  Given a longitudinal data frame with covariate
information, along with treatment time, build a MIP problem that matches
treated individuals to those that haven't been treated yet (or are never
treated) based on minimizing the Mahalanobis distance between covariates. If
balancing is desired, the model will try to minimize the imbalance in terms
of specified balancing covariates in the final pair output.  Each treated
individual is matched to one other individual."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rsmatch</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0.9003</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/risk-set-matching-with-rsmatch.html">Risk Set Matching with rsmatch</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/skent259/rsmatch/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Balanced Risk Set Matching</h1>
      <small class="dont-index">Source: <a href="https://github.com/skent259/rsmatch/blob/HEAD/R/brsmatch.R" class="external-link"><code>R/brsmatch.R</code></a></small>
      <div class="d-none name"><code>brsmatch.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Perform balanced risk set matching as described in Li et al. (2001) "Balanced
Risk Set Matching".  Given a longitudinal data frame with covariate
information, along with treatment time, build a MIP problem that matches
treated individuals to those that haven't been treated yet (or are never
treated) based on minimizing the Mahalanobis distance between covariates. If
balancing is desired, the model will try to minimize the imbalance in terms
of specified balancing covariates in the final pair output.  Each treated
individual is matched to one other individual.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">brsmatch</span><span class="op">(</span></span>
<span>  <span class="va">n_pairs</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  id <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>  time <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>  trt_time <span class="op">=</span> <span class="st">"trt_time"</span>,</span>
<span>  covariates <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  balance <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  balance_covariates <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  exact_match <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>time_lag <span class="op">=</span> <span class="cn">FALSE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span>, optimizer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"glpk"</span>, <span class="st">"gurobi"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>n_pairs</dt>
<dd><p>The number of pairs desired from matching.</p></dd>


<dt>data</dt>
<dd><p>A data.frame or similar containing columns matching the <code>id, time, trt_time</code> arguments, and covariates. This data frame is expected to
be in tidy, long format, so that <code>id</code>, <code>trt_time</code>, and other variables may
be repeated for different values of <code>time</code>. The data.frame should be unique
at <code>id</code> and <code>time</code>.</p></dd>


<dt>id</dt>
<dd><p>A character specifying the id column name (default <code>'id'</code>).</p></dd>


<dt>time</dt>
<dd><p>A character specifying the time column name (default <code>'time'</code>).</p></dd>


<dt>trt_time</dt>
<dd><p>A character specifying the treatment time column name
(default <code>'trt_time'</code>).</p></dd>


<dt>covariates</dt>
<dd><p>A character vector specifying the covariates to use for
matching (default <code>NULL</code>). If <code>NULL</code>, this will default to all columns
except those named by the <code>id</code>, <code>time</code>, and <code>trt_time</code> arguments.</p></dd>


<dt>balance</dt>
<dd><p>A logical value indicating whether to include balancing
constraints in the matching process.</p></dd>


<dt>balance_covariates</dt>
<dd><p>A character vector specifying the covariates to use
for balancing (default <code>NULL</code>).  If <code>NULL</code>, this will default to all
columns except those named by the <code>id</code>, <code>time</code>, and <code>trt_time</code> arguments.</p></dd>


<dt>exact_match</dt>
<dd><p>A vector of optional covariates to perform exact matching
on. If <code>NULL</code>, no exact matching is done.</p></dd>


<dt>options</dt>
<dd><p>A list of additional parameters with the following components:</p><ul><li><p><code>time_lag</code> A logical value indicating whether the matches should be made
on the time period preceding treatment.  This can help avoid confounding if
treatment happens between two periods.</p></li>
<li><p><code>verbose</code> A logical value
indicating whether to print information to the console during a potentially
long matching process.</p></li>
<li><p><code>optimizer</code> The optimizer to use (default
<code>'glpk'</code>). The option <code>'gurobi'</code> requires an external license and package,
but offers speed improvements.</p></li>
</ul></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A data frame containing the pair information.  The data frame has
columns <code>id</code>, <code>pair_id</code>, and <code>type</code>. <code>id</code> matches the input parameter and
will contain all ids from the input data frame.  <code>pair_id</code> refers to the id
of the computed pairs; <code>NA</code> values indicate unmatched individuals.  <code>type</code></p>


<p>indicates whether the individual in the pair is considered as treatment
("trt") or control ("all") in that pair.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Note that when using exact matching, the <code>n_pairs</code> are split roughly in
proportion to the number of treated subjects in each exact matching group.
If you would like to control <code>n_pairs</code> exactly, we suggest manually
performing exact matching, for example with <code><a href="https://rdrr.io/r/base/split.html" class="external-link">split()</a></code>, and selecting
<code>n_pairs</code> for each group interactively.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Li, Yunfei Paul, Kathleen J Propert, and Paul R Rosenbaum. 2001.
"Balanced Risk Set Matching." Journal of the American Statistical
Association 96 (455): 870-82.
<a href="https://doi.org/10.1198/016214501753208573" class="external-link">doi:10.1198/016214501753208573</a></p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Sean Kent</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"Rglpk"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">pairs</span> <span class="op">&lt;-</span> <span class="fu">brsmatch</span><span class="op">(</span></span></span>
<span class="r-in"><span>    n_pairs <span class="op">=</span> <span class="fl">13</span>,</span></span>
<span class="r-in"><span>    data <span class="op">=</span> <span class="va">oasis</span>,</span></span>
<span class="r-in"><span>    id <span class="op">=</span> <span class="st">"subject_id"</span>,</span></span>
<span class="r-in"><span>    time <span class="op">=</span> <span class="st">"visit"</span>,</span></span>
<span class="r-in"><span>    trt_time <span class="op">=</span> <span class="st">"time_of_ad"</span>,</span></span>
<span class="r-in"><span>    balance <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">pairs</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># evaluate the first match</span></span></span>
<span class="r-in"><span>  <span class="va">first_match</span> <span class="op">&lt;-</span> <span class="va">pairs</span><span class="op">$</span><span class="va">subject_id</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">pairs</span><span class="op">$</span><span class="va">pair_id</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">oasis</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">subject_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">first_match</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘dplyr’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:stats’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     filter, lag</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:base’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     intersect, setdiff, setequal, union</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 6 × 11</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   subject_id visit time_of_ad m_f    educ ses     age mr_delay e_tiv n_wbv   asf</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> OAS2_0007      1          3 M        16 -1       71        0  <span style="text-decoration: underline;">1</span>357 0.748  1.29</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> OAS2_0007      3          3 M        16 -1       73      518  <span style="text-decoration: underline;">1</span>365 0.727  1.29</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span> OAS2_0007      4          3 M        16 -1       75     <span style="text-decoration: underline;">1</span>281  <span style="text-decoration: underline;">1</span>372 0.71   1.28</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span> OAS2_0058      1         <span style="color: #BB0000;">NA</span> M        14 3        78        0  <span style="text-decoration: underline;">1</span>315 0.707  1.34</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span> OAS2_0058      2         <span style="color: #BB0000;">NA</span> M        14 3        79      212  <span style="text-decoration: underline;">1</span>308 0.706  1.34</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">6</span> OAS2_0058      3         <span style="color: #BB0000;">NA</span> M        14 3        80      764  <span style="text-decoration: underline;">1</span>324 0.695  1.33</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="https://github.com/skent259" class="external-link">Sean Kent</a>, Mitchell Paukner.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

